!function(){function isDescendant(e,t){return e&&(e.parentNode==t||e.parentNode!=document&&isDescendant(e.parentNode,t))}function getElementsByClassName(e,t){var n=[],i=new RegExp("\\b"+e+"\\b"),o=t.getElementsByTagName("*");t=t||document.getElementsByTagName("body")[0];for(var s=0,a=o.length;a>s;s++)i.test(o[s].className)&&n.push(o[s]);return n}function extend(e,t,n){for(key in t)n&&(isPlainObject(t[key])||isArray(t[key]))?(isPlainObject(t[key])&&!isPlainObject(e[key])&&(e[key]={}),isArray(t[key])&&!isArray(e[key])&&(e[key]=[]),extend(e[key],t[key],n)):void 0!==t[key]&&(e[key]=t[key])}window.Light=function(e,t){return new Light.core.init(e,t)},window.$||(window.$=window.Light),Light.core=Light.prototype={init:function(e,t){var n;if(e=e||window,t=t&&t.els&&t.els.length?t.els[0]:t||document,n="string"==typeof e?Light.selector(e,t):n=e,this.els=[],null!=n)if("undefined"!=typeof n.length)for(var i=0,o=n.length;o>i;i++)null!=n[i]&&this.els.push(n[i]);else this.els.push(n);return this},get:function(e){return"undefined"==typeof e?this.els:this.els[e]},count:function(){return this.els.length},each:function(e){for(var t=0,n=this.els.length;n>t;t++)e.call(this,this.els[t]);return this},attr:function(e,t,n){return this.each(function(i){"undefined"==typeof n?i[e]=t:i[n][e]=t}),this},css:function(e){var t=this;return this.each(function(){for(var n in e)t.attr(n,e[n],"style")}),this},addClass:function(e){return this.each(function(t){$(t).hasClass(e)||(t.className+=" "+e)}),this},removeClass:function(e){return this.each(function(t){var n=t.className.replace(e,"");n=n.replace(new RegExp("[\\s]{2,}")," "),t.className=n}),this},on:function(e,t){var n=function(n){window.addEventListener?n.addEventListener(e,t,!1):window.attachEvent&&n.attachEvent("on"+e,function(){t.call(n,window.event)})};return this.each(function(e){n(e)}),this},trigger:function(e,t){var n;return document.createEvent?(n=document.createEvent("CustomEvent"),n.initCustomEvent(e,!0,!0,t)):(n=document.createEventObject(),n.eventType=e),n.eventName=e,n.memo=t||{},this.each(function(e){document.createEvent?e.dispatchEvent(n):e.fireEvent("on"+n.eventType,n)}),this},ready:function(e){return DOMReady.add(e),this},remove:function(){return this.each(function(e){e.parentNode.removeChild(e)}),this},hasClass:function(e){for(var t=0,n=this.els.length;n>t;t++)if(this.els[t].className.match(new RegExp("(\\s|^)"+e+"(\\s|$)")))return!0;return!1},html:function(e){return e?void this.each(function(t){try{t.innerHTML=e}catch(n){var i=document.createElement("div");for(i.innerHTML=e;t.firstChild;)t.removeChild(t.firstChild);for(var o=0,s=i.childNodes.length;s>o;o++)t.appendChild(i.childNodes[o])}}):this.els[0].innerHTML},show:function(){this.each(function(e){$(e).css({display:"block"})})},hide:function(){this.each(function(e){$(e).css({display:"none"})})},setBackgroundImage:function(e){this.each(function(t){$(t).css({backgroundImage:'url("'+e+'")'})})}},Light.selector=function(e,t){for(var n,i,o,s=e.split(","),a=0;a<s.length;a++){var r=s[a].replace(/ /g,"");"string"==typeof r&&(i=r.substr(0,1),o=r.substr(1),"#"==i?(n=document.getElementById(o),n=isDescendant(n,t)?n:null):n="."==i?getElementsByClassName(o,t):t.getElementsByTagName(r))}return n},Light.core.init.prototype=Light.core;var DOMReady=function(){var fns=[],isReady=!1,ready=function(){isReady=!0;for(var e=0;e<fns.length;e++)fns[e].call()};return this.add=function(fn){if(fn.constructor==String){var strFunc=fn;fn=function(){eval(strFunc)}}isReady?fn.call():fns[fns.length]=fn},window.addEventListener&&document.addEventListener("DOMContentLoaded",function(){ready()},!1),this}();Light.ready=DOMReady.add,$.extend=function(e){var t,n=[].slice.call(arguments,1);return"boolean"==typeof e&&(t=e,e=n.shift()),n.forEach(function(n){extend(e,n,t)}),e}}(),function(e,t){e.app=e.app||{},e.app.loadFEN=function(e,n,i){var o=function(e){for(var t=0;e>=8;)t++,e-=8;return{col:e,row:t}},s=t.getElementById(n);s.style.width=8*i+"px",s.style.height=8*i+"px";var a,r=e.split(/\s/g)[0];for(a=0;64>a;a++){var c=a%8,l=0===a?0:Math.floor(a/8),u=t.createElement("div");u.style.top=l*i+"px",u.style.left=c*i+"px",u.style.width=i+"px",u.style.height=i+"px",u.className="square "+(a%2===0&&l%2===0||a%2==1&&l%2==1?"w":"b"),s.appendChild(u)}var p,f=0;for(a=0;a<r.length;a++){var d=r.substr(a,1);if(d.match(/[A-Z]/i)){var h=o(f),m=t.createElement("div");m.style.top=h.row*i+"px",m.style.left=h.col*i+"px",m.style.width=i+"px",m.style.height=i+"px",m.className="piece",d.match(/[A-Z]/)&&(p="w"),d.match(/[a-z]/)&&(p="b"),m.style.backgroundImage="url(images/highres/"+d.toLowerCase()+p+".png)",s.appendChild(m),f++}d.match(/[0-8]/)&&(f+=parseInt(d))}}}(this,this.document),function(e){e.VK_LEFT=37,e.VK_UP=38,e.VK_RIGHT=39,e.VK_DOWN=40,e.VK_ENTER=13,e.VK_BACK=8,e.VK_EXIT=27,e.VK_0=48,e.VK_1=49,e.VK_2=50,e.VK_3=51,e.VK_4=52,e.VK_5=53,e.VK_6=54,e.VK_7=55,e.VK_8=56,e.VK_9=57,e.app=e.app||{},e.app.prepareDevice=function(){console.log("prepare device")},e.app.exit=function(){console.log("app.exit")},e.app.initDevice=function(){console.log("init device"),e.app.start()}}(this),function(e){e.app=e.app||{};e.app.initNav=function(){$(document).on("keydown",function(t){t.preventDefault(),e.app.exit()}),$(".nav").on("click",function(){e.app.exit()}),$(".nav").on("mouseover",function(e){$cur=$(".focus"),$cur.removeClass("focus"),$elt=$(e.target),$elt.addClass("focus")})},e.app.setFocus=function(e){$(".focus").removeClass("focus"),$(e).addClass("focus")}}(this),function(e){e.app=e.app||{};var t=function(t){var n=e.location.href,o=n.split(/[\?&]+/);for(i=0;i<o.length;i++){var s=o[i].split("=");if(s[0]==t)return s[1]}return!1},n=!1;e.app.setPollUrl=function(e){e&&14==e.length&&(n="http://"+parseInt(e.substr(0,3))+"."+parseInt(e.substr(3,3))+"."+parseInt(e.substr(6,3))+"."+parseInt(e.substr(9,3))+":80"+parseInt(e.substr(12,2)))},e.app.setPollUrl(t("LANCode")||(t("debug")?"19216817802392":!1));var o=!1,s=function(e,t,n){try{var i=new XMLHttpRequest;i.open("GET",e,!0),i.setRequestHeader("Accept","application/json"),i.timeout=1e4,i.onreadystatechange=function(){4==i.readyState&&(200==i.status?t(i.responseText):n(i.status))},i.send()}catch(o){console.log("xhr caught "+o),n(0)}};e.app.poll=function(){console.log("Polling: "+n),n?s(n,function(t){document.body.className="connected";try{var n=JSON.parse(t);console.log("Got FEN "+n.FEN),o!=n.FEN&&(e.app.loadFEN(n.FEN,"board",70),o=n.FEN)}catch(i){console.log(i)}setTimeout(function(){e.app.poll()},1e3)},function(t){console.log("xhr status "+t),document.body.className="no-connection",setTimeout(function(){e.app.poll()},5e3)}):document.body.className="no-device"}}(this),!function(e){"use strict";for(var t,n,i={},o=function(){},s="memory".split(","),a="assert,clear,count,debug,dir,dirxml,error,exception,group,groupCollapsed,groupEnd,info,log,markTimeline,profile,profiles,profileEnd,show,table,time,timeEnd,timeline,timelineEnd,timeStamp,trace,warn".split(",");t=s.pop();)e[t]=e[t]||i;for(;n=a.pop();)e[n]=e[n]||o}(this.console=this.console||{}),function(e){e.app=e.app||{},e.app.onLoad=function(){e.app.initDevice()},e.app.start=function(){e.app.initNav(),e.app.poll()},e.app.prepareDevice()}(this);